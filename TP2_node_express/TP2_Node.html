<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>TP 2 Avanc√© Web Full-Stack</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg,#0f172a,#1e293b,#111827);
  color: #e5e7eb;
  margin: 0;
  padding-top: 100px;
  padding-left: 250px;
  box-sizing: border-box;
}
header {
  position: fixed;
  top: 0;
  left: 250px;
  width: calc(100% - 250px);
  height: 100px;
  z-index: 100;
  background: #000;
  backdrop-blur: blur(8px);
  padding: 20px 40px;
  box-sizing: border-box;
}
#sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 250px;
  height: 100%;
  background: rgba(15,23,42,0.95);
  border-right: 1px solid #0ff;
  padding: 20px;
  overflow-y: auto;
  z-index: 60;
}
#sidebar h3 {
  font-size: 16px;
  font-weight: bold;
  color: #0ff;
  margin-bottom: 12px;
}
#sidebar ul { list-style: none; padding: 0; }
#sidebar ul li { margin-bottom: 8px; }
#sidebar ul li a { color: #e5e7eb; text-decoration: none; font-size: 14px; }
#sidebar ul li a:hover { color: #06b6d4; }

section {
  max-width: 1000px;
  margin: 24px auto;
  padding: 24px;
  border-radius: 12px;
  background: rgba(15,23,42,0.85);
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}
h2 { color: #0ff; font-weight: bold; margin-bottom: 12px; }
h3 { color: #facc15; margin-top: 12px; margin-bottom: 8px; }
pre { background: #0f172a; padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 14px; }
button.copy-btn { background: #0ff; color: #111827; padding: 6px 12px; border-radius: 6px; cursor: pointer; margin-bottom: 8px; font-weight: bold; }
button.copy-btn:hover { background: #06b6d4; }
textarea { width: 100%; min-height: 100px; margin-top: 8px; padding: 10px; border-radius: 6px; border: 1px solid #0ff; background: #111827; color: #e5e7eb; }
button.evaluate-btn { background: #facc15; color: #111827; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px; cursor: pointer; }
button.evaluate-btn:hover { background: #eab308; }
</style>

<script>
function copyCode(id){
  navigator.clipboard.writeText(document.getElementById(id).innerText);
  alert("Code copi√© !");
}

function evaluateAnswer(textareaId, outputId){
  const text = document.getElementById(textareaId).value;
  let score = 0;
  if(text.trim().length > 0) score = 100; 
  document.getElementById(outputId).innerText = "√âvaluation simple : " + score + "%";
}
</script>
</head>

<body>

<!-- Sidebar -->
<div id="sidebar">
<h3>Navigation TP2 </h3>
<ul>
<li><a href="#front">1. Front-End</a></li>
<li><a href="#back">2. Back-End</a></li>
<li><a href="#integration">3. Int√©gration Full-Stack</a></li>
<li><a href="#astuces">4. Astuces & Bonnes Pratiques</a></li>
<li><a href="#exercices">5. Exercices & √âvaluation</a></li>
</ul>
</div>

<!-- Header -->
<header class="flex justify-between items-center mb-6">
<div>
<h1 class="text-3xl font-extrabold text-cyan-400">TP 2 Dev Web Full-Stack</h1>
<p class="text-gray-400 mt-2">Gestion d'√©v√©nements avec Node.js, Express et Front-End moderne</p>
</div>
</header>
<section class="text-gray-400 mt-2">
  <h1 class="text-3xl font-extrabold text-cyan-400">Partie I: Node, express et Json</h1>
</section>
<section id="node-express-tp" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f4f7f9; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.1);">

  <h2 style="color: #1a73e8; border-bottom: 2px solid #1a73e8; padding-bottom: 6px;">Pourquoi Node.js et Express ?</h2>

  <div style="margin-top: 20px; padding: 15px; background: #e8f0fe; border-left: 5px solid #1a73e8; border-radius: 8px;">
    <h2 style="color: #0b3d91;">Node.js : le moteur serveur JavaScript</h2>
    <p class="text-gray-400 mt-2">Node.js est <strong>un environnement d‚Äôex√©cution JavaScript c√¥t√© serveur</strong>, bas√© sur le moteur V8 de Google Chrome.</p>
    <ul class="text-gray-400 mt-2" style="margin-left: 20px;">
      <li><strong>Single-threaded :</strong> G√®re des milliers de connexions simultan√©es via l‚Äô<em>event loop</em>.</li>
      <li><strong>Non bloquant :</strong> Les op√©rations E/S sont asynchrones, pour des performances optimales.</li>
      <li><strong>JavaScript c√¥t√© serveur :</strong> R√©utilisation du code front-end c√¥t√© back-end.</li>
    </ul>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">const</span> http = <span class="string">require('http')</span>;

http.createServer((req, res) => {
  res.write(<span class="string">'Hello Node.js'</span>);
  res.end();
}).listen(<span class="number">3000</span>);
</code></pre>
  </div>
</div>
  <div style="margin-top: 25px; padding: 15px; background: #fff3e0; border-left: 5px solid #fb8c00; border-radius: 8px;">
    <h2 style="color: #e65100;"> Express : le framework web l√©ger</h2>
    <p class="text-gray-400 mt-2">Express est <strong>un framework minimaliste pour Node.js</strong> qui simplifie la cr√©ation d‚Äôapplications web.</p>
    <ul class="text-gray-400 mt-2" style="margin-left: 20px;">
      <li>Gestion simplifi√©e des routes HTTP : GET, POST, PUT, DELETE‚Ä¶</li>
      <li>Middlewares pour authentification, logging, parsing JSON, etc.</li>
      <li>Structure claire : s√©paration routes, contr√¥leurs et services.</li>
    </ul>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">const</span> express = <span class="string">require('express')</span>;
<span class="keyword">const</span> app = express();

app.use(express.json());

app.get(<span class="string">'/events'</span>, (req, res) => {
  res.json([{title: <span class="string">"TP Node"</span>, date: <span class="string">"2026-01-11"</span>}]);
});

app.post(<span class="string">'/events'</span>, (req, res) => {
  <span class="keyword">const</span> { title } = req.body;
  res.json({status: <span class="string">"ok"</span>, title});
});

app.listen(<span class="number">3000</span>, () => console.log(<span class="string">"Server running on port 3000"</span>));
</code></pre>
  </div>
</div>
  <div style="margin-top: 25px; padding: 15px; background: #e0f7fa; border-left: 5px solid #00acc1; border-radius: 8px;">
    <h2 style="color: #006064;"> R√¥le combin√© Node + Express</h2>
    <table class="text-gray-400 mt-2" style="width: 100%; border-collapse: collapse; margin-top: 12px;">
      <thead>
        <tr style="background: #00acc1; color: #fff;">
          <th style="padding: 8px; border-radius: 6px 0 0 6px;">√âl√©ment</th>
          <th style="padding: 8px;">R√¥le dans le TP</th>
        </tr>
      </thead>
      <tbody>
        <tr style="background: #b2ebf2;">
          <td style="padding: 8px;">Node.js</td>
          <td style="padding: 8px;">Ex√©cute le code c√¥t√© serveur et g√®re les requ√™tes HTTP asynchrones</td>
        </tr>
        <tr style="background: #80deea;">
          <td style="padding: 8px;">Express</td>
          <td style="padding: 8px;">Simplifie routes, middlewares et structure du code</td>
        </tr>
        <tr style="background: #b2ebf2;">
          <td style="padding: 8px;">Front-end</td>
          <td style="padding: 8px;">Envoie les requ√™tes HTTP et affiche dynamiquement les √©v√©nements</td>
        </tr>
      </tbody>
    </table>

    <p class="text-gray-400 mt-2" style="margin-top: 12px;"><strong>Astuce ing√©nieur :</strong> Node seul fonctionne mais Express rend le code maintenable et extensible, indispensable pour des projets avanc√©s.</p>
  </div>

</section>

<style>
/* Styles pour blocs de code avec coloration syntaxique simple */
.code-block {
  background-color: #1e1e1e;
  color: #d4d4d4;
  padding: 12px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  line-height: 1.5;
}

/* Syntax highlighting basique */
.code-block .keyword { color: #569cd6; font-weight: bold; }
.code-block .string { color: #d69d85; }
.code-block .number { color: #b5cea8; }
</style>

<!-- Front-End -->
<!-- ================= FRONT-END ================= -->
<section id="front" class="tp-card blue">

  <h2>Front-End (HTML / JavaScript)</h2>

  <p class="text-gray-400 mt-2">
    Le <strong>front-end</strong> fournit l‚Äôinterface utilisateur permettant
    de <strong>cr√©er</strong> et <strong>visualiser</strong> les √©v√©nements.
    La communication avec le serveur se fait via la <strong>Fetch API</strong>,
    qui envoie des requ√™tes HTTP asynchrones vers l‚ÄôAPI Node.js.
  </p>

  <h3 class="text-gray-400 mt-2"> <strong>Formulaire + communication HTTP</strong> </h3>

 <div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="tag">&lt;form</span> <span class="attr">id</span>=<span class="string">"eventForm"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">required</span><span class="tag">&gt;</span>
  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">id</span>=<span class="string">"date"</span> <span class="attr">required</span><span class="tag">&gt;</span>
  <span class="tag">&lt;textarea</span> <span class="attr">id</span>=<span class="string">"description"</span><span class="tag">&gt;&lt;/textarea&gt;</span>
  <span class="tag">&lt;button&gt;</span>Envoyer<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/form&gt;</span>

<span class="tag">&lt;ul</span> <span class="attr">id</span>=<span class="string">"eventsList"</span><span class="tag">&gt;&lt;/ul&gt;</span>

<span class="keyword">const</span> BASE_URL = <span class="string">"http://localhost:3000/events"</span>;

document.getElementById(<span class="string">'eventForm'</span>)
  .addEventListener(<span class="string">'submit'</span>, <span class="keyword">async</span> (e) =&gt; {
    e.preventDefault();

    <span class="keyword">const</span> event = {
      title: document.getElementById(<span class="string">'title'</span>).value,
      date: document.getElementById(<span class="string">'date'</span>).value,
      description: document.getElementById(<span class="string">'description'</span>).value
    };

    <span class="keyword">await</span> fetch(BASE_URL, {
      method: <span class="string">'POST'</span>,
      headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
      body: JSON.stringify(event)
    });

    fetchEvents();
});
</code></pre></div>

  <p class="tip">
    üí° <strong>Astuce ing√©nieur :</strong>  
    La validation c√¥t√© client am√©liore l‚Äôexp√©rience utilisateur,
    mais <strong>ne remplace jamais</strong> la validation c√¥t√© serveur.
  </p>
</section>

<!-- ================= BACK-END ================= -->
<section id="back" class="tp-card orange">

  <h2> Back-End (Node.js / Express)</h2>

  <p>
    Le serveur Express agit comme une <strong>API REST</strong>.
    Il expose des routes HTTP et applique des <strong>middlewares</strong>
    pour g√©rer le CORS, le parsing JSON et la validation des donn√©es.
  </p>

  <h3>üìå API REST minimale mais robuste</h3>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">const</span> express = <span class="string">require('express')</span>;
<span class="keyword">const</span> cors = <span class="string">require('cors')</span>;

<span class="keyword">const</span> app = express();
app.use(cors());
app.use(express.json());

<span class="keyword">let</span> events = [];

app.get(<span class="string">'/events'</span>, (req, res) =&gt; {
  res.json(events);
});

app.post(<span class="string">'/events'</span>, (req, res) =&gt; {
  <span class="keyword">const</span> { title, date, description } = req.body;

  <span class="keyword">if</span> (!title || !date) {
    <span class="keyword">return</span> res.status(<span class="number">400</span>)
      .json({ error: <span class="string">"Champs manquants"</span> });
  }

  events.push({ title, date, description });
  res.json({ status: <span class="string">"ok"</span> });
});

app.listen(<span class="number">3000</span>, () =&gt;
  console.log(<span class="string">"Server running on port 3000"</span>)
);
</code></pre></div>

  <ul>
    <li>‚úîÔ∏è Validation serveur obligatoire</li>
    <li>‚úîÔ∏è Middleware CORS indispensable en front/back s√©par√©s</li>
    <li>‚ùå Stockage m√©moire interdit en production</li>
  </ul>
</section>

<!-- ================= INTEGRATION ================= -->
<section id="integration" class="tp-card cyan">

  <h2> Int√©gration Full-Stack</h2>

  <p>
    Le <strong>front-end</strong> consomme l‚ÄôAPI REST via Fetch.
    Le format JSON agit comme <strong>contrat d‚Äô√©change</strong>
    entre les deux couches.
  </p>

  <div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">async function</span> fetchEvents() {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'/events'</span>);
    <span class="keyword">const</span> data = <span class="keyword">await</span> res.json();

    data.forEach(ev =&gt; console.log(ev));
  } <span class="keyword">catch</span> (err) {
    console.error(err);
  }
}
</code></pre></div>

  <p class="tip">
    üí° <strong>Astuce avanc√©e :</strong>  
    Toujours g√©rer les erreurs r√©seau et serveur (timeouts, 500, 404).
  </p>
</section>

<!-- ================= ASTUCES ================= -->
<section id="astuces" class="tp-card dark">

  <h2> Astuces & Bonnes pratiques</h2>

  <ul>
    <li>Utiliser <code>dotenv</code> pour les variables sensibles</li>
    <li>Ne jamais bloquer l‚Äôevent loop</li>
    <li>S√©parer routes / contr√¥leurs / services</li>
    <li>Utiliser <code>helmet</code>, <code>rate-limit</code>, <code>morgan</code></li>
  </ul>
</section>
<section id="schema-realtime" class="tp-card cyan">

  <h2>üîÅ Sch√©ma explicatif : fonctionnement en temps r√©el</h2>

  <p>
    Ce sch√©ma illustre pourquoi les modifications apparaissent
    <strong>sans rechargement de la page</strong> lors de l‚Äôajout d‚Äôun √©v√©nement.
  </p>

  <div class="schema">

    <!-- Browser -->
    <div class="box browser">
      <h3>Navigateur</h3>
      <p>
        HTML / CSS<br>
        JavaScript actif<br>
        DOM en m√©moire
      </p>
    </div>

    <div class="arrow">fetch()</div>

    <!-- Server -->
    <div class="box server">
      <h3>Serveur Node.js</h3>
      <p>
        Express<br>
        Routes API<br>
        JSON
      </p>
    </div>

  </div>

  <div class="schema-steps">
    <ol>
      <li>L‚Äôutilisateur soumet le formulaire</li>
      <li>JavaScript intercepte l‚Äô√©v√©nement (<code>preventDefault()</code>)</li>
      <li>Fetch envoie une requ√™te HTTP asynchrone</li>
      <li>Node.js traite la requ√™te et renvoie du JSON</li>
      <li>JavaScript met √† jour le DOM</li>
      <li>Le navigateur redessine la page automatiquement</li>
    </ol>
  </div>

  <p class="tip">
    üí° <strong>Point cl√© :</strong>  
    Aucune navigation HTTP n‚Äôa lieu. Le DOM est modifi√© en m√©moire,
    ce qui donne l‚Äôillusion du temps r√©el.
  </p>

</section>
<!-- Travail √† Faire -->
<section id="travail" class="tp-card green">
  <h2>üõ†Ô∏è Travail √† Faire : Application de Gestion d'√âv√©nements</h2>

  <p>
    Dans cette section, vous allez impl√©menter un formulaire complet pour ajouter des √©v√©nements
    avec <strong>titre, date, lieu, description, affiche, fiche descriptive</strong> et 
    <strong>adresse via carte interactive Leaflet</strong>.
  </p>

  <!-- √âtape 1 : Formulaire complet -->
  <div class="step">
    <h2 style="color:#1a73e8; border-bottom:2px solid #1a73e8; padding-bottom:6px;">
Formulaire HTML de cr√©ation d‚Äôun √©v√©nement
</h2>

<p style="color:#555; margin-top:10px;">
Ce formulaire repr√©sente la <strong>couche Front-end</strong> du TP.  
Il collecte les informations utilisateur qui seront envoy√©es au serveur Node.js
via une requ√™te <strong>POST</strong>.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="tag">&lt;form</span> <span class="attr">id</span>=<span class="string">"eventForm"</span><span class="tag">&gt;</span>

  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"text"</span>
         <span class="attr">id</span>=<span class="string">"title"</span>
         <span class="attr">placeholder</span>=<span class="string">"Titre"</span>
         <span class="attr">required</span><span class="tag">&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"date"</span>
         <span class="attr">id</span>=<span class="string">"date"</span>
         <span class="attr">required</span><span class="tag">&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"text"</span>
         <span class="attr">id</span>=<span class="string">"location"</span>
         <span class="attr">placeholder</span>=<span class="string">"Lieu"</span>
         <span class="attr">required</span><span class="tag">&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;textarea</span> <span class="attr">id</span>=<span class="string">"description"</span>
            <span class="attr">placeholder</span>=<span class="string">"Description"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;/textarea&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"file"</span>
         <span class="attr">id</span>=<span class="string">"poster"</span>
         <span class="attr">accept</span>=<span class="string">"image/*"</span><span class="tag">&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;input</span> <span class="attr">type</span>=<span class="string">"file"</span>
         <span class="attr">id</span>=<span class="string">"fileDesc"</span>
         <span class="attr">accept</span>=<span class="string">".pdf,.txt"</span><span class="tag">&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;div</span> <span class="attr">id</span>=<span class="string">"map"</span>
       <span class="attr">style</span>=<span class="string">"height:300px;"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;/div&gt;</span>

  <span class="tag">&lt;button</span> <span class="attr">type</span>=<span class="string">"button"</span>
          <span class="attr">id</span>=<span class="string">"validateAddress"</span><span class="tag">&gt;</span>
    Valider l'adresse
  <span class="tag">&lt;/button&gt;</span><span class="tag">&lt;br&gt;</span>

  <span class="tag">&lt;button</span> <span class="attr">type</span>=<span class="string">"submit"</span><span class="tag">&gt;</span>
    Enregistrer l'√©v√©nement
  <span class="tag">&lt;/button&gt;</span>

<span class="tag">&lt;/form&gt;</span>
</code></pre>
</div>

<p style="color:#666; margin-top:12px;">
<strong>Note p√©dagogique :</strong>  
Ce formulaire est volontairement <em>simple c√¥t√© HTML</em>.  
Toute la logique m√©tier (validation, stockage, fichiers, g√©olocalisation)
est d√©port√©e vers <strong>JavaScript</strong> et <strong>Node.js</strong>.
</p>
  <p><strong>Astuce :</strong> Vous pouvez utiliser <code>FormData</code> pour g√©rer fichiers et texte ensemble.</p>
  </div>

  <!-- √âtape 2 : Carte interactive Leaflet -->
  <div class="step">
    <h3> √âtape 2 : Ajouter une carte interactive Leaflet</h3>
    <p>
      La carte doit permettre √† l'utilisateur :
    </p>
    <ul>
      <li>De saisir l'adresse manuellement et mettre √† jour le marqueur</li>
      <li>De cliquer directement sur la carte pour positionner l'√©v√©nement</li>
    </ul>
    
<p style="color:#555; margin-top:10px;">
Cette partie illustre l‚Äôint√©gration de <strong>Leaflet</strong> pour permettre √† l‚Äôutilisateur
de s√©lectionner une position g√©ographique directement sur une carte.
Les coordonn√©es seront ensuite envoy√©es au serveur Node.js.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">const</span> map = L.map(<span class="string">'map'</span>)
  .setView([<span class="number">36.8</span>, <span class="number">10.2</span>], <span class="number">6</span>); 
<span class="comment">// Carte centr√©e sur la Tunisie</span>

L.tileLayer(
  <span class="string">'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'</span>,
  { <span class="attr">attribution</span>: <span class="string">'¬© OpenStreetMap'</span> }
).addTo(map);

<span class="keyword">let</span> marker;

map.on(<span class="string">'click'</span>, e =&gt; {
  <span class="keyword">if</span> (marker) {
    marker.setLatLng(e.latlng);
  } <span class="keyword">else</span> {
    marker = L.marker(e.latlng).addTo(map);
  }
  console.log(<span class="string">"Coordonn√©es s√©lectionn√©es :"</span>, e.latlng);
});

document.getElementById(<span class="string">'validateAddress'</span>)
  .addEventListener(<span class="string">'click'</span>, () =&gt; {

  <span class="keyword">const</span> address =
    document.getElementById(<span class="string">'location'</span>).value;

  <span class="comment">// Ici on pourra utiliser un service de g√©ocodage (Nominatim)</span>
  console.log(<span class="string">"Adresse valid√©e :"</span>, address);
});
</code></pre>
</div>

<p style="color:#666; margin-top:12px;">
<strong>Astuce ing√©nieur :</strong>  
En pratique, l‚Äôadresse saisie peut √™tre convertie en coordonn√©es GPS
via une API de g√©ocodage (<em>Nominatim, Google Geocoding, Mapbox</em>),
puis synchronis√©e avec le marqueur Leaflet.
</p>


  </div>

  <!-- √âtape 3 : Enregistrement dans events.json -->
  <div class="step">
    <h3> √âtape 3 : Sauvegarder l'√©v√©nement dans <code>events.json</code></h3>
    <p>
      Lorsqu‚Äôun √©v√©nement est enregistr√© :
    </p>
    <ul>
      <li>Envoyer les donn√©es au serveur via <code>fetch</code> POST</li>
      <li>Le serveur ajoute l‚Äô√©v√©nement dans <code>events.json</code></li>
      <li>Mettre √† jour la section r√©sum√© sur la page</li>
    </ul>

  
    <h2 style="color:#1a73e8; border-bottom:2px solid #1a73e8; padding-bottom:6px;">
Sauvegarde d‚Äôun √©v√©nement c√¥t√© serveur (JSON)
</h2>

<p style="color:#555; margin-top:10px;">
Avant l‚Äôutilisation d‚Äôune base de donn√©es, nous pouvons stocker les √©v√©nements
dans un fichier <strong>events.json</strong>.  
Cette approche est simple et p√©dagogique, mais <strong>non adapt√©e √† la production</strong>.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">const</span> fs = <span class="string">require</span>(<span class="string">'fs'</span>);

app.post(<span class="string">'/events'</span>, (req, res) =&gt; {
  <span class="keyword">const</span> event = req.body;

  <span class="comment">// Lecture du fichier JSON existant</span>
  <span class="keyword">const</span> events = JSON.parse(
    fs.readFileSync(<span class="string">'events.json'</span>)
  );

  <span class="comment">// Ajout du nouvel √©v√©nement</span>
  events.push(event);

  <span class="comment">// √âcriture dans le fichier avec indentation</span>
  fs.writeFileSync(
    <span class="string">'events.json'</span>,
    JSON.stringify(events, <span class="keyword">null</span>, <span class="number">2</span>)
  );

  res.json({ <span class="attr">status</span>: <span class="string">"ok"</span> });
});
</code></pre>
</div>

<p style="color:#666; margin-top:12px;">
<strong>Analyse technique :</strong>
</p>

<ul style="color:#666; margin-left:20px;">
  <li><strong>fs.readFileSync</strong> : lecture synchrone ‚Üí bloque l‚Äôevent loop</li>
  <li><strong>JSON.parse</strong> : conversion texte ‚Üí objet JavaScript</li>
  <li><strong>fs.writeFileSync</strong> : √©criture compl√®te du fichier</li>
</ul>

<div style="
margin-top:15px;
padding:12px;
background:#fff3e0;
border-left:5px solid #fb8c00;
border-radius:8px;
color:#6d4c41;
">
<strong>‚ö† Limite importante :</strong><br>
Cette solution ne supporte pas :
<ul style="margin-left:20px;">
  <li>acc√®s concurrents</li>
  <li>grands volumes de donn√©es</li>
  <li>recherches complexes</li>
</ul>
‚û°Ô∏è C‚Äôest pour cela que nous migrerons vers <strong>MySQL</strong>.
</div>
    <p><strong>Astuce :</strong> Toujours lire le fichier avant de push pour √©viter d‚Äô√©craser les √©v√©nements existants.</p>
  </div>

  <!-- √âtape 4 : Affichage et suppression des √©v√©nements -->
  <div class="step">
    <h2 style="color:#1a73e8; border-bottom:2px solid #1a73e8; padding-bottom:6px;">
R√©cup√©ration et affichage des √©v√©nements (Fetch + CRUD)
</h2>

<p style="color:#555; margin-top:10px;">
Cette fonction illustre la r√©cup√©ration des √©v√©nements depuis le serveur, leur affichage dans le DOM,
et la suppression d‚Äôun √©v√©nement via une requ√™te <strong>DELETE</strong>.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="keyword">async function</span> fetchEvents() {
  <span class="keyword">const</span> res = await fetch(<span class="string">'/events'</span>);
  <span class="keyword">const</span> events = await res.json();

  <span class="keyword">const</span> list = document.getElementById(<span class="string">'eventsList'</span>);
  list.innerHTML = <span class="string">''</span>;

  events.forEach((ev, idx) =&gt; {
    <span class="keyword">const</span> li = document.createElement(<span class="string">'li'</span>);
    li.textContent = `${ev.title} - ${ev.date} - ${ev.location}`;

    <span class="keyword">const</span> btn = document.createElement(<span class="string">'button'</span>);
    btn.textContent = <span class="string">"Supprimer"</span>;

    btn.onclick = <span class="keyword">async</span> () =&gt; {
      await fetch(`/events/${idx}`, { method: <span class="string">'DELETE'</span> });
      fetchEvents();
    };

    li.appendChild(btn);
    list.appendChild(li);
  });
}

fetchEvents();
</code></pre>
</div>

<p style="color:#666; margin-top:12px;">
<strong>Explications techniques :</strong>
<ul style="margin-left:20px;">
  <li><strong>fetch('/events')</strong> : r√©cup√®re les √©v√©nements du serveur via GET</li>
  <li><strong>events.forEach</strong> : it√®re et cr√©e dynamiquement les √©l√©ments HTML</li>
  <li><strong>btn.onclick</strong> : envoie DELETE vers le serveur pour supprimer un √©v√©nement</li>
  <li><strong>fetchEvents() apr√®s suppression</strong> : rechargement de la liste pour mise √† jour imm√©diate</li>
</ul>
</p>

  </div>

  <!-- √âtape 5 : Recommandations d'am√©lioration -->
  <div class="step">
    <h3>Recommandations d'am√©lioration</h3>
    <ul>
      <li>G√©rer la validation des fichiers (taille, type) c√¥t√© serveur</li>
      <li>Ajouter un aper√ßu de l'image et du PDF avant enregistrement</li>
      <li>Mettre en place un syst√®me de notifications pour succ√®s / erreur</li>
      <li>Ajouter une recherche ou filtre sur les √©v√©nements</li>
      
    </ul>
  </div>

 
</section>
 <section class="text-gray-400 mt-2">
  <h1 class="text-3xl font-extrabold text-cyan-400">Partie II: Node, express et MySQL</h1>
  </section>
<style>
.tp-card.green {
  background: #e8f5e9;
  border: 2px solid #43a047;
  border-radius: 12px;
 margin: 25px auto;
  padding: 20px;
}

.step {
  background: #ffffffdd;
  border-left: 4px solid #43a047;
  padding: 16px;
  margin: 12px 0;
  border-radius: 8px;
}

.step h3 {
  margin-top: 0;
  color: #2e7d32;
}

.copy-btn {
  margin-bottom: 6px;
  background-color: #43a047;
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
}

.copy-btn:hover {
  background-color: #2e7d32;
}

pre {
  background: #263238;
  color: #eceff1;
  padding: 12px;
  border-radius: 6px;
  overflow-x: auto;
}
</style>

<style>
/* ===== Sch√©ma ===== */

.schema {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 30px 0;
  gap: 30px;
}

.box {
  width: 260px;
  padding: 16px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

.browser {
  background: #e3f2fd;
  border: 2px solid #1a73e8;
}

.server {
  background: #fff3e0;
  border: 2px solid #fb8c00;
}

.arrow {
  font-weight: bold;
  font-size: 18px;
  color: #37474f;
}

.schema-steps ol {
  margin-left: 20px;
}

.schema-steps li {
  margin-bottom: 6px;
}
</style>

<!-- ================= STYLE GLOBAL ================= -->
<style>
.tp-card {
  max-width: 900px;
  margin: 25px auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  font-family: 'Segoe UI', sans-serif;
  color: #263238;   /* gris fonc√© lisible (recommand√©) */
  line-height: 1.6;
}
.blue { background:#e8f0fe; border-left:6px solid #08011f; }
.orange { background:#fff3e0; border-left:6px solid #fb8c00; }
.cyan { background:#e0f7fa; border-left:6px solid #00acc1; }
.dark { background:#263238; color:#fff; border-left:6px solid #90caf9; }

.blue h2   { color: #0d47a1; }
.orange h2 { color: #e65100; }
.cyan h2   { color: #006064; }
.dark h2   { color: #bbdefb; }

.code-block {
  background:#1e1e1e;
  color:#d4d4d4;
  padding:14px;
  border-radius:8px;
  overflow-x:auto;
  font-family:'Fira Code', monospace;
  font-size:14px;
}

.keyword { color:#569cd6; font-weight:bold; }
.string { color:#d69d85; }
.number { color:#b5cea8; }
.tag { color:#4ec9b0; }
.attr { color:#9cdcfe; }

.tip {
  margin-top:10px;
  padding:10px;
  background:#ffffffaa;
  border-left:4px solid #1a73e8;
}
</style>
<section id="node-express-tp" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f4f7f9; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.1);">

<p style="color:#555; margin-top:10px;">
Dans cette partie du TP, nous allons remplacer le fichier <strong>events.json</strong>
par une <strong>base de donn√©es MySQL</strong> afin de stocker les √©v√©nements
de mani√®re professionnelle et persistante.
</p>

<!-- ETAPE 1 -->
<div style="margin-top:25px; padding:15px; background:#e8f0fe;
border-left:5px solid #1a73e8; border-radius:8px;">

<h3 style="color:#0b3d91;">√âtape 1 ‚Äì Cr√©ation de la base de donn√©es MySQL</h3>

<p class="text-gray-400 mt-2">
Nous commen√ßons par cr√©er une base appel√©e <strong>tp_events</strong>
qui contiendra toutes les informations des √©v√©nements.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>
<pre class="code-block"><code>
<span class="keyword">CREATE DATABASE</span> tp_events;
<span class="keyword">USE</span> tp_events;
</code></pre>
</div>

<p style="color:#666; margin-top:10px;">
üëâ Cette commande doit √™tre ex√©cut√©e dans <strong>MySQL</strong> (phpMyAdmin ou terminal).
</p>
</div>

<!-- ETAPE 2 -->
<div style="margin-top:25px; padding:15px; background:#fff3e0;
border-left:5px solid #fb8c00; border-radius:8px;">

<h3 style="color:#e65100;">√âtape 2 ‚Äì Cr√©ation de la table <code>events</code></h3>

<p class="text-gray-400 mt-2">
La table <strong>events</strong> stocke les informations saisies dans le formulaire HTML.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>
<pre class="code-block"><code>
<span class="keyword">CREATE TABLE</span> events (
  id <span class="keyword">INT AUTO_INCREMENT PRIMARY KEY</span>,
  titre <span class="keyword">VARCHAR</span>(255),
  date <span class="keyword">DATE</span>,
  lieu <span class="keyword">VARCHAR</span>(255),
  description <span class="keyword">TEXT</span>,
  adresse <span class="keyword">VARCHAR</span>(255),
  lat <span class="keyword">FLOAT</span>,
  lng <span class="keyword">FLOAT</span>,
  affiche <span class="keyword">VARCHAR</span>(255),
  fiche <span class="keyword">VARCHAR</span>(255)
);
</code></pre>
</div>

<p style="color:#666; margin-top:10px;">
üëâ Chaque ligne correspond √† <strong>un √©v√©nement universitaire</strong>.
</p>
</div>

<!-- ETAPE 3 -->
<div style="margin-top:25px; padding:15px; background:#e8f5e9;
border-left:5px solid #43a047; border-radius:8px;">

<h3 style="color:#2e7d32;">√âtape 3 ‚Äì Connexion Node.js ‚Üî MySQL</h3>

<p class="text-gray-400 mt-2">
Dans <strong>server.js</strong>, on utilise le module <code>mysql2</code>
pour communiquer avec la base de donn√©es.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>
<pre class="code-block"><code>
<span class="keyword">const</span> mysql = <span class="string">require('mysql2')</span>;

<span class="keyword">const</span> db = mysql.createConnection({
  host: <span class="string">'localhost'</span>,
  user: <span class="string">'root'</span>,
  password: <span class="string">''</span>,
  database: <span class="string">'tp_events'</span>
});

db.connect(() => {
  console.log(<span class="string">'‚úÖ MySQL connect√©'</span>);
});
</code></pre>
</div>

<p style="color:#666; margin-top:10px;">
üëâ Cette connexion permet √† Express d‚Äôex√©cuter des requ√™tes SQL.
</p>
</div>

<!-- ETAPE 4 -->
<div style="margin-top:25px; padding:15px; background:#f3e5f5;
border-left:5px solid #8e24aa; border-radius:8px;">

<h3 style="color:#6a1b9a;">√âtape 4 ‚Äì Enregistrer un √©v√©nement (POST)</h3>


<h2 style="color:#1a73e8; border-bottom:2px solid #1a73e8; padding-bottom:6px;">
R√©cup√©ration et enregistrement d‚Äôun √©v√©nement (POST /events)
</h2>

<p style="color:#555; margin-top:10px;">
Cette route Express permet de :
<ul style="color:#555; margin-left:20px;">
  <li>r√©cup√©rer les donn√©es du formulaire HTML</li>
  <li>traiter les fichiers envoy√©s (affiche + fiche)</li>
  <li>valider les champs obligatoires</li>
  <li>ins√©rer l‚Äô√©v√©nement dans la base MySQL</li>
</ul>
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>

<pre class="code-block"><code>
<span class="comment">// POST /events - Cr√©er un nouvel √©v√©nement</span>
app.post(<span class="string">'/events'</span>, upload.fields([
  { name: <span class="string">'affiche'</span>, maxCount: <span class="number">1</span> },
  { name: <span class="string">'fiche'</span>, maxCount: <span class="number">1</span> }
]), (req, res) => {

  console.log(<span class="string">'üì• Body re√ßu:'</span>, req.body);
  console.log(<span class="string">'üìÅ Fichiers re√ßus:'</span>, req.files);

  <span class="keyword">const</span> { titre, date, lieu, description, adresse, lat, lng } = req.body;

  <span class="comment">// V√©rification des champs obligatoires</span>
  <span class="keyword">if</span> (!titre || !date || !lieu) {
    <span class="keyword">return</span> res.status(<span class="number">400</span>).json({
      error: <span class="string">'Titre, date et lieu sont obligatoires'</span>
    });
  }

  <span class="keyword">const</span> affiche = req.files?.affiche
    ? req.files.affiche[<span class="number">0</span>].filename
    : <span class="keyword">null</span>;

  <span class="keyword">const</span> fiche = req.files?.fiche
    ? req.files.fiche[<span class="number">0</span>].filename
    : <span class="keyword">null</span>;

  <span class="keyword">const</span> sql = <span class="string">`
    INSERT INTO events
    (titre, date, lieu, description, adresse, lat, lng, affiche, fiche)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
  `</span>;

  <span class="keyword">const</span> values = [
    titre,
    date,
    lieu,
    description || <span class="string">''</span>,
    adresse || <span class="string">''</span>,
    lat || <span class="keyword">null</span>,
    lng || <span class="keyword">null</span>,
    affiche,
    fiche
  ];

  db.query(sql, values, (err, result) => {
    <span class="keyword">if</span> (err) {
      console.error(<span class="string">'‚ùå Erreur INSERT:'</span>, err);
      <span class="keyword">return</span> res.status(<span class="number">500</span>).json({
        error: <span class="string">'Erreur lors de la cr√©ation'</span>
      });
    }

    res.json({
      message: <span class="string">'‚úÖ √âv√©nement cr√©√© avec succ√®s'</span>,
      id: result.insertId
    });
  });
});
</code></pre>
</div>

<p style="color:#666; margin-top:12px;">
<strong>Remarque p√©dagogique :</strong>  
Cette impl√©mentation illustre une vraie logique <em>backend professionnelle</em> :
validation, upload de fichiers, requ√™tes pr√©par√©es et gestion d‚Äôerreurs.
</p>

</div>

<!-- ETAPE 5 -->
<div style="margin-top:25px; padding:15px; background:#e1f5fe;
border-left:5px solid #039be5; border-radius:8px;">

<h3 style="color:#0277bd;">√âtape 5 ‚Äì Lire les √©v√©nements (GET)</h3>

<p class="text-gray-400 mt-2">
Au chargement de la page, les √©v√©nements sont r√©cup√©r√©s depuis MySQL
et affich√©s dans la liste.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>
<pre class="code-block"><code>
app.get(<span class="string">'/events'</span>, (req, res) => {
  db.query(<span class="string">'SELECT * FROM events'</span>,
    (err, rows) => res.json(rows)
  );
});
</code></pre>
</div>
</div>

<!-- ETAPE 6 -->
<div style="margin-top:25px; padding:15px; background:#ffebee;
border-left:5px solid #e53935; border-radius:8px;">

<h3 style="color:#c62828;">√âtape 6 ‚Äì Supprimer un √©v√©nement (DELETE)</h3>

<p class="text-gray-400 mt-2">
Chaque √©v√©nement poss√®de un bouton <strong>Supprimer</strong>
qui enl√®ve la ligne correspondante de la base.
</p>

<div class="code-container">
<button onclick="copyCode(this)">üìã Copier</button>
<pre class="code-block"><code>
app.delete(<span class="string">'/events/:id'</span>, (req, res) => {
  db.query(
    <span class="string">'DELETE FROM events WHERE id = ?'</span>,
    [req.params.id],
    () => res.json({ status: <span class="string">'deleted'</span> })
  );
});
</code></pre>
</div>
</div>

</section>
</section>
<!-- STYLE CODE -->
<style>
.code-block {
  background:#1e1e1e;
  color:#dcdcdc;
  padding:15px;
  border-radius:8px;
  overflow-x:auto;
  font-size:14px;
}
.keyword { color:#569cd6; }
.string { color:#ce9178; }
.number { color:#b5cea8; }

.code-container {
  position: relative;
}
.code-container button {
  position:absolute;
  top:8px; right:8px;
  background:#1a73e8;
  color:white;
  border:none;
  padding:5px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}
</style>

<script>
function copyCode(btn){
  const code = btn.nextElementSibling.innerText;
  navigator.clipboard.writeText(code);
  btn.innerText = "‚úÖ Copi√©";
  setTimeout(()=>btn.innerText="üìã Copier",1500);
}
</script>

</body>
</html>
